# Story 2.4: Update Documentation for Cloudflare Stack

## Status
**Draft**

## Story
**As a** developer,  
**I want** all documentation updated to reflect the Cloudflare technology stack,  
**so that** documentation is accurate and doesn't reference outdated AWS/Upstash/Render services

## Acceptance Criteria
1. [ ] Remove all references to AWS S3 from documentation
2. [ ] Remove all references to Upstash (Redis & Vector) from documentation  
3. [ ] Remove all references to Render.com from documentation
4. [ ] Update technology stack sections to reflect Cloudflare services
5. [ ] Update environment configuration docs for Cloudflare
6. [ ] Archive outdated deployment guides
7. [ ] Update README.md with current stack information
8. [ ] Ensure setup guides reflect current configuration

## Tasks / Subtasks

### Task 1: Audit and update architecture documentation (AC: 1, 2, 3, 4)
- [ ] Review and update `docs/architecture/tech-stack.md`
  - [ ] Remove AWS S3 references, replace with Cloudflare R2
  - [ ] Remove Upstash Redis references, replace with Cloudflare KV
  - [ ] Remove Upstash Vector references, replace with Cloudflare Vectorize
- [ ] Review and update `docs/architecture/technology-stack.md`
  - [ ] Update storage section: AWS S3 → Cloudflare R2
  - [ ] Update caching section: Upstash Redis → Cloudflare KV
  - [ ] Update vector DB section: Upstash Vector → Cloudflare Vectorize
- [ ] Review and update `docs/architecture/architecture-overview.md`
  - [ ] Update infrastructure diagram if present
  - [ ] Update service descriptions
- [ ] Review and update `docs/architecture/core-components.md`
  - [ ] Update storage component descriptions
  - [ ] Update caching layer descriptions
- [ ] Review and update `docs/architecture/data-flow-and-integration.md`
  - [ ] Update data flow to reflect Cloudflare services
  - [ ] Update integration points
- [ ] Review and update `docs/architecture/integration-points.md`
  - [ ] Remove Render.com deployment references
  - [ ] Add Cloudflare Workers/Containers references

### Task 2: Update deployment and operations documentation (AC: 3, 4, 5, 6)
- [ ] Archive old deployment guides
  - [ ] Create `docs/ARCHIVE/` directory if not exists
  - [ ] Move `docs/DEPLOYMENT.md` to `docs/ARCHIVE/`
  - [ ] Move `docs/DEPLOYMENT_GUIDE.md` to `docs/ARCHIVE/`
  - [ ] Move `docs/PRODUCTION_DEPLOYMENT.md` to `docs/ARCHIVE/`
- [ ] Create new Cloudflare deployment documentation
  - [ ] Create `docs/CLOUDFLARE_DEPLOYMENT.md` with current deployment process
  - [ ] Document Cloudflare Workers deployment
  - [ ] Document Cloudflare KV setup
  - [ ] Document Cloudflare R2 configuration
  - [ ] Document Cloudflare Vectorize setup
- [ ] Update operational guides
  - [ ] Update `docs/operations/deployment-checklist.md` for Cloudflare
  - [ ] Update `docs/DEPLOYMENT_CHECKLIST.md` for Cloudflare
  - [ ] Remove all Render-specific configurations

### Task 3: Update environment and setup documentation (AC: 5, 8)
- [ ] Update environment setup docs
  - [ ] Update `docs/ENVIRONMENT_SETUP.md` with Cloudflare variables
  - [ ] Update `docs/setup/environment.md` to remove AWS/Upstash variables
  - [ ] Update `docs/setup/complete-setup.md` with Cloudflare setup steps
  - [ ] Update `docs/setup/github-secrets.md` for Cloudflare CI/CD
- [ ] Update environment variables
  - [ ] Update `.env.example` to remove old variables:
    - [ ] Remove: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION
    - [ ] Remove: S3_BUCKET_NAME
    - [ ] Remove: UPSTASH_REDIS_REST_URL, UPSTASH_REDIS_REST_TOKEN
    - [ ] Remove: UPSTASH_VECTOR_REST_URL, UPSTASH_VECTOR_REST_TOKEN
    - [ ] Remove: RENDER_SERVICE_NAME
  - [ ] Add new Cloudflare variables to `.env.example`:
    - [ ] Add: CLOUDFLARE_ACCOUNT_ID
    - [ ] Add: CLOUDFLARE_API_TOKEN
    - [ ] Add: CLOUDFLARE_KV_NAMESPACE_ID
    - [ ] Add: CLOUDFLARE_VECTORIZE_INDEX
    - [ ] Add: CLOUDFLARE_R2_BUCKET
    - [ ] Add: CLOUDFLARE_R2_ACCESS_KEY_ID
    - [ ] Add: CLOUDFLARE_R2_SECRET_ACCESS_KEY
    - [ ] Add: CLOUDFLARE_R2_ENDPOINT

### Task 4: Update PRD and requirements documentation (AC: 1, 2, 3, 4)
- [ ] Update Product Requirements Document
  - [ ] Update `docs/prd.md` tech stack section
  - [ ] Update `docs/prd/technical-constraints.md` with Cloudflare constraints
  - [ ] Update `docs/prd/non-functional-requirements.md` for Cloudflare performance
  - [ ] Update `docs/prd/functional-requirements.md` if affected by stack change
  - [ ] Update `docs/prd/assumptions-and-dependencies.md` for Cloudflare
  - [ ] Mark Epic 1 (Cloudflare Migration) as complete in PRD

### Task 5: Update project README and main documentation (AC: 7, 8)
- [ ] Update root README.md
  - [ ] Update "Technology Stack" section
  - [ ] Update "Quick Start" guide to use Cloudflare
  - [ ] Update "Local Development" instructions
  - [ ] Add "Cloudflare Dashboard" links section
  - [ ] Update "Troubleshooting" section for Cloudflare issues
- [ ] Update contribution guides
  - [ ] Update any CONTRIBUTING.md with new setup
  - [ ] Update development workflow documentation

### Task 6: Clean up memory configuration documentation (AC: 1, 2)
- [ ] Update memory and vector storage docs
  - [ ] Update all files in `docs/operations/memory-configuration/`
  - [ ] Remove Upstash Vector references from mem0 documentation
  - [ ] Update to use Cloudflare Vectorize for vector storage
  - [ ] Ensure graph memory docs reflect current implementation

### Task 7: Archive migration-related documentation (AC: 6)
- [ ] Archive completed migration guides
  - [ ] Move `docs/CF_MIGRATION_GUIDE.md` to `docs/ARCHIVE/`
  - [ ] Move `docs/operations/cloudflare-migration.md` to `docs/ARCHIVE/`
  - [ ] Add header note: "ARCHIVED - Migration Complete as of [date]"
  - [ ] Keep as historical reference

### Task 8: Final documentation validation (AC: 8)
- [ ] Run validation checks
  - [ ] Search for remaining AWS references: `grep -r "AWS\|S3_BUCKET" docs/ --include="*.md"`
  - [ ] Search for remaining Upstash: `grep -r "Upstash\|UPSTASH" docs/ --include="*.md"`
  - [ ] Search for remaining Render: `grep -r "Render\|RENDER" docs/ --include="*.md"`
  - [ ] Verify Cloudflare documented: `grep -r "Cloudflare" docs/ --include="*.md"`
- [ ] Test documentation
  - [ ] Follow setup instructions on fresh environment
  - [ ] Verify all environment variables are documented
  - [ ] Ensure all links and references work
  - [ ] Check code examples are updated

## Dev Notes

### Prerequisite
**Story 2.2 (BrainBot rename) should be completed first** to avoid confusion with naming conventions in documentation.

### Current Stack References to Update

Based on analysis, 67+ documentation files contain references to the old stack that need updating.

### Technology Stack Changes

**FROM (Old Stack):**
- **Storage**: AWS S3
- **Cache**: Upstash Redis  
- **Vector DB**: Upstash Vector
- **Hosting**: Render.com
- **Database**: Supabase (unchanged)

**TO (New Stack):**
- **Storage**: Cloudflare R2
- **Cache**: Cloudflare KV
- **Vector DB**: Cloudflare Vectorize
- **Hosting**: Cloudflare Workers/Containers
- **Database**: Supabase (unchanged)

### Documentation Structure

```
docs/
├── architecture/         # Architecture documentation (needs updating)
├── operations/          # Operational guides (needs updating)
├── prd/                 # Product requirements (needs updating)
├── setup/              # Setup guides (needs updating)
├── stories/            # User stories (keep as-is)
├── technical/          # Technical specs (needs review)
└── ARCHIVE/            # Archived docs (move outdated here)
```

### Priority Files with Heavy Old-Stack References

1. `docs/architecture/tech-stack.md`
2. `docs/architecture/technology-stack.md`
3. `docs/ENVIRONMENT_SETUP.md`
4. `docs/DEPLOYMENT_CHECKLIST.md`
5. `docs/PRODUCTION_DEPLOYMENT.md`
6. `docs/setup/environment.md`
7. `docs/setup/github-secrets.md`
8. Root `README.md`

### Search Commands for Validation

```bash
# Find remaining AWS references
grep -r "AWS\|S3_BUCKET" docs/ --include="*.md" | grep -v ARCHIVE

# Find remaining Upstash references  
grep -r "Upstash\|UPSTASH" docs/ --include="*.md" | grep -v ARCHIVE

# Find remaining Render references
grep -r "Render\|RENDER" docs/ --include="*.md" | grep -v ARCHIVE

# Verify Cloudflare references added
grep -r "Cloudflare" docs/ --include="*.md"

# Check environment variables documented
diff <(grep -o "CLOUDFLARE_[A-Z_]*" .env.example | sort -u) \
     <(grep -o "CLOUDFLARE_[A-Z_]*" docs/ -r --include="*.md" | cut -d: -f2 | sort -u)
```

### Documentation Standards to Follow

- Use clear, concise Markdown for all documentation
- Include code examples where applicable
- Maintain consistent formatting across all docs
- Add "Last Updated: YYYY-MM-DD" to documentation files
- Never invent technical details not present in source files
- Cross-reference all technical claims with architecture documents
- Mark legacy sections clearly before archiving
- Ensure consistency between README, setup guides, and architecture docs

### Cloudflare Services Documentation Template

When documenting Cloudflare services, use this structure:

```markdown
## Service Name (e.g., Cloudflare KV)
- **Purpose**: What it replaces and why
- **Configuration**: Required environment variables
- **Usage**: How it's used in the application
- **Dashboard**: Link to Cloudflare dashboard section
- **Limitations**: Any constraints or quotas
- **Cost**: Pricing tier implications
```

## Testing

### Documentation Validation Process

```bash
# Step 1: Verify no broken internal links
find docs -name "*.md" -exec grep -l "](/" {} \;

# Step 2: Check for outdated service references
grep -r "AWS\|S3_BUCKET\|Upstash\|UPSTASH\|Render\|RENDER" docs/ --include="*.md" | grep -v ARCHIVE

# Step 3: Verify Cloudflare references properly added
grep -r "Cloudflare\|CLOUDFLARE_" docs/ --include="*.md"

# Step 4: Test setup instructions (manual)
# Follow docs/setup/complete-setup.md on fresh environment
```

### Documentation Review Checklist

- [ ] Primary: `README.md`, `docs/CLOUDFLARE_DEPLOYMENT.md`, `.env.example`
- [ ] Architecture: All files in `docs/architecture/*.md`
- [ ] Setup: All files in `docs/setup/*.md`
- [ ] Operations: `docs/operations/*.md` focusing on deployment and memory config
- [ ] No automated tests required for documentation changes
- [ ] Manual review required for all documentation updates
- [ ] Validate all code examples compile/run correctly

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-27 | 1.0 | Story created from split of original 2.2 | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
[To be filled by dev agent]

### Debug Log References
[To be filled by dev agent]

### Completion Notes List
[To be filled by dev agent]

### File List
[To be filled by dev agent - expected ~30-40 files modified]

## QA Results
[To be filled by QA agent]